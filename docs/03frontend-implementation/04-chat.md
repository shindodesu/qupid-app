# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…è¨ˆç”»æ›¸: ãƒãƒ£ãƒƒãƒˆ

## ğŸ“‹ æ¦‚è¦
ãƒãƒƒãƒã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼é–“ã®1å¯¾1ãƒãƒ£ãƒƒãƒˆã‚’ãƒ•ãƒ­ãƒ³ãƒˆã§å®Ÿè£…ã™ã‚‹è¨ˆç”»ã€‚å±¥æ­´å–å¾—ã€é€å—ä¿¡ã€æ—¢èª­ã€æœªèª­æ•°è¡¨ç¤ºã¾ã§ã‚’å¯¾è±¡ã¨ã—ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã¯å°†æ¥æ‹¡å¼µï¼ˆSSE/WebSocketï¼‰ã€‚

## ğŸ”Œ å¯¾å¿œAPI
- GET `/conversations` ä¼šè©±ä¸€è¦§
- POST `/conversations` ä¼šè©±ä½œæˆï¼ˆãƒãƒƒãƒæ™‚ï¼‰
- GET `/conversations/{id}` ä¼šè©±è©³ç´°
- GET `/conversations/{id}/messages` ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´
- POST `/conversations/{id}/messages` é€ä¿¡
- PUT `/conversations/{id}/messages/{message_id}/read` æ—¢èª­
- GET `/conversations/{id}/unread-count` æœªèª­æ•°

## ğŸ§­ ç”»é¢/ãƒ«ãƒ¼ãƒˆ
- `/chat` ä¼šè©±ä¸€è¦§
- `/chat/[conversationId]` ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”»é¢

## ğŸ§± ãƒ‡ãƒ¼ã‚¿å‹ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆï¼‰
```ts
// src/types/chat.ts
export type Message = {
  id: number
  content: string
  sender_id: number
  sender_name: string
  is_read: boolean
  created_at: string
}

export type Conversation = {
  id: number
  type: 'direct' | 'group'
  title?: string | null
  other_user: { id: number; display_name: string; bio?: string | null }
  last_message?: Pick<Message, 'id' | 'content' | 'sender_id' | 'is_read' | 'created_at'> | null
  unread_count: number
  created_at: string
  updated_at: string
}
```

## ğŸ§° ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- `ConversationList`ï¼ˆç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«/ä»®æƒ³åŒ–ï¼‰
- `ChatWindow`ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ãƒ»ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒªã‚¹ãƒˆãƒ»å…¥åŠ›ï¼‰
- `MessageBubble`ï¼ˆè‡ªåˆ†/ç›¸æ‰‹ã§ã‚¹ã‚¿ã‚¤ãƒ«åˆ†å²ï¼‰
- `MessageComposer`ï¼ˆå…¥åŠ›é€ä¿¡ã€Enteré€ä¿¡ã€æ·»ä»˜ã¯å°†æ¥ï¼‰
- `TypingIndicator`ï¼ˆå°†æ¥ï¼‰

## ğŸ”„ React Query ã‚­ãƒ¼
- `['conversations']` ä¸€è¦§
- `['conversation', id]` è©³ç´°
- `['messages', id]` å±¥æ­´

## ğŸ§  æ—¢èª­ãƒ»æœªèª­è¨­è¨ˆ
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”»é¢è¡¨ç¤ºæ™‚ã«è‡ªåˆ†ä»¥å¤–ã®æœ€æ–°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ—¢èª­åŒ–ï¼ˆãƒ•ã‚©ãƒ¼ã‚«ã‚¹/å¯è¦–æ™‚ï¼‰
- ä¸€è¦§ã§ã¯ `unread_count` ã‚’ãƒãƒƒã‚¸è¡¨ç¤ºã€é€ä¿¡/æ—¢èª­æ›´æ–°ã§åŒæœŸ

## âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒªã‚¹ãƒˆã¯ä»®æƒ³åŒ–ï¼ˆä¾‹: `react-virtuoso`ï¼‰
- ãƒšãƒ¼ã‚¸ãƒ³ã‚°/ç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã€é€†æ–¹å‘ãƒ­ãƒ¼ãƒ‰ï¼ˆéå»ã«é¡ã‚‹ï¼‰

## ğŸ§ª ãƒ†ã‚¹ãƒˆ
- ä¸€è¦§è¡¨ç¤º/ã‚½ãƒ¼ãƒˆï¼ˆæœ€æ–°æ›´æ–°é †ï¼‰
- å±¥æ­´ãƒšãƒ¼ã‚¸ãƒ³ã‚°
- é€ä¿¡ã®æ¥½è¦³çš„è¿½åŠ /å¤±æ•—ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
- æ—¢èª­æ›´æ–°ã®åæ˜ 

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£/è€ƒæ…®
- å‚åŠ è€…ãƒã‚§ãƒƒã‚¯ã¯APIå´ã€‚UIã¯ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã¨å®‰å…¨é·ç§»
- XSSå¯¾ç­–ï¼ˆãƒ†ã‚­ã‚¹ãƒˆã®ã¿ã€URLè‡ªå‹•ãƒªãƒ³ã‚¯ã¯å°†æ¥ï¼‰

## ğŸ“ˆ æˆåŠŸæŒ‡æ¨™
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡å¿œç­” < 300msï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é™¤ãï¼‰
- åˆå›å±¥æ­´è¡¨ç¤º < 1sã€ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é…å»¶ãªã—
- æ—¢èª­åæ˜ é…å»¶ < 1s

## ğŸ“‹ å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
- [ ] `/chat` ä¼šè©±ä¸€è¦§ï¼ˆæœªèª­æ•°ãƒ»æœ€çµ‚ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰
- [ ] `/chat/[id]` å±¥æ­´è¡¨ç¤ºãƒ»ç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
- [ ] é€ä¿¡ï¼ˆæ¥½è¦³çš„æ›´æ–°ï¼‰
- [ ] æ—¢èª­æ›´æ–°ï¼ˆç”»é¢è¡¨ç¤º/ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ï¼‰
- [ ] ã‚¨ãƒ©ãƒ¼/å†è©¦è¡ŒUX
- [ ] ãƒ†ã‚¹ãƒˆï¼ˆå˜ä½“/çµ±åˆ/E2Eï¼‰

---
ä½œæˆæ—¥: 2025-10-13 / æ‹…å½“: Qupidé–‹ç™ºãƒãƒ¼ãƒ 



