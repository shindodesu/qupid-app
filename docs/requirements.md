# Qupid プロジェクト要件定義書（改訂版）

## 📋 プロジェクト概要

* **プロジェクト名**：Qupid（キューピッド）
* **目的**：九州大学内のLGBTQ当事者学生が、匿名で安心して恋人・友人とつながることを支援するマッチングWebアプリを提供する
* **開発形態**：Webアプリ（将来的にネイティブ展開も想定）
* **使用技術**：
  - **バックエンド**: Python + FastAPI + PostgreSQL + SQLAlchemy + Alembic
  - **フロントエンド**: React/Next.js + Tailwind CSS（予定）
* **開発環境**：CURSORエディタ / GitHub
* **ホスティング予定**：Render or Railway（API） + Vercel or Netlify（フロント）

---

## ✅ 想定ユーザー

* 九州大学のLGBTQ+当事者学生
* 恋人／友達づくりをしたい学生
* 匿名・安全に人とつながりたい学生
* 学内限定で安心してマッチングしたい学生

---

## 🧩 機能要件（MVP対象）

### 1. 認証・プロフィール機能
* 九州大学のメールアドレス（@s.kyushu-u.ac.jp）での認証
* 匿名プロフィール登録（ニックネーム、学年、学部、自己紹介等）
* プロフィール編集機能
* JWT認証によるセキュアなセッション管理

### 2. タグ管理機能
* ユーザーが自由にタグを作成・管理
* プロフィールにタグを追加・削除
* タグベースでの検索・フィルタリング
* 将来的なAI自動タグ生成の基盤

### 3. ユーザー検索・フィルター機能
* タグや属性（学部・学年など）で絞り込み検索
* フリーテキスト検索（ニックネーム、自己紹介）
* 複数条件での絞り込み
* ページネーション対応
* おすすめユーザー機能

### 4. いいね・マッチング機能
* ユーザー一覧表示・いいね送信
* 両想い時にマッチング成立
* マッチしたユーザー一覧取得
* いいね履歴の管理
* マッチング状況の確認

### 5. チャット機能
* マッチしたユーザー間での1対1チャット
* メッセージ送信・受信
* メッセージ履歴の取得
* 既読管理機能
* 未読メッセージ数の表示

### 6. セーフティ機能
* 不適切ユーザーへの通報機能
* 特定ユーザーのブロック機能
* 通報の管理・処理（管理者用）
* ブロックユーザーとの相互作用制限

### 7. 管理者機能
* 通報の確認・処理
* ユーザー管理
* システム統計

---

## 🛠️ 技術要件

### バックエンド
* **フレームワーク**: FastAPI
* **データベース**: PostgreSQL
* **ORM**: SQLAlchemy 2.0（非同期）
* **認証**: JWT（PyJWT）
* **設定管理**: Pydantic Settings
* **マイグレーション**: Alembic
* **コンテナ**: Docker & Docker Compose

### フロントエンド（予定）
* **フレームワーク**: React + Next.js または Vue.js + Nuxt.js
* **スタイリング**: Tailwind CSS
* **状態管理**: Zustand または Pinia
* **API通信**: Axios または Fetch API
* **UIコンポーネント**: Headless UI または Radix UI

### インフラ
* **開発環境**: Docker Compose
* **本番環境**: Render/Railway（API）+ Vercel/Netlify（フロント）
* **データベース**: PostgreSQL（本番環境）

---

## 📊 データベース設計

### 主要テーブル
* **users**: ユーザー基本情報
* **tags**: タグマスター
* **user_tags**: ユーザーとタグの関連（多対多）
* **likes**: いいね情報
* **conversations**: 会話
* **conversation_members**: 会話メンバー
* **messages**: メッセージ
* **reports**: 通報情報
* **blocks**: ブロック情報

### 設計原則
* 多対多リレーションの適切な実装
* データ整合性の確保（CASCADE削除、制約）
* パフォーマンス最適化（インデックス設計）
* セキュリティ考慮（外部キー制約）

---

## 🔌 API設計

### 認証API
* `POST /auth/login` - ログイン
* `GET /auth/verify` - 認証確認

### ユーザーAPI
* `GET /users/me` - 自分の情報取得
* `PUT /users/me` - 自分の情報更新

### タグ管理API
* `GET /tags` - タグ一覧取得
* `POST /tags` - タグ作成
* `GET /users/me/tags` - 自分のタグ一覧
* `POST /users/me/tags` - 自分のタグに追加
* `DELETE /users/me/tags/{tag_id}` - 自分のタグから削除

### いいね・マッチングAPI
* `POST /likes` - いいね送信
* `GET /likes/sent` - 送信したいいね一覧
* `GET /likes/received` - 受け取ったいいね一覧
* `GET /matches` - マッチしたユーザー一覧

### ユーザー検索API
* `GET /users/search` - ユーザー検索・フィルタリング
* `GET /users/suggestions` - おすすめユーザー取得

### チャットAPI
* `GET /conversations` - 会話一覧取得
* `POST /conversations` - 会話作成
* `GET /conversations/{id}/messages` - メッセージ履歴取得
* `POST /conversations/{id}/messages` - メッセージ送信

### セーフティAPI
* `POST /reports` - ユーザー通報
* `POST /blocks` - ユーザーブロック
* `GET /blocks/my` - ブロック一覧取得
* `DELETE /blocks/{user_id}` - ブロック解除

---

## 🎨 UI/UX要件

### デザイン原則
* **匿名性**: 顔出し不要、プライバシー保護
* **安全性**: セーフティ機能の充実
* **使いやすさ**: 直感的な操作
* **レスポンシブ**: モバイル・デスクトップ対応

### 主要画面
* ログイン・プロフィール登録画面
* ホーム画面（ユーザー一覧・検索）
* プロフィール画面（表示・編集）
* マッチ一覧画面
* チャット画面
* 設定画面

### Figmaデザイン活用
* デザインシステムの構築
* コンポーネントベースの開発
* デザイントークンの抽出・活用

---

## 🔒 セキュリティ要件

### 認証・認可
* JWT認証によるセキュアなセッション管理
* 九州大学メールアドレスでの認証
* 適切な権限管理

### データ保護
* 個人情報の適切な管理
* メッセージ内容の保護
* 通報・ブロック情報の管理

### セーフティ機能
* 不適切行為の通報機能
* ブロック機能による相互作用制限
* 管理者による適切な対応

---

## 📈 実装計画（ロードマップ）

### Phase 1: 基盤構築（完了）
* [x] GitHubリポジトリ構築
* [x] FastAPI + PostgreSQL 接続
* [x] ユーザーモデル・CRUD実装
* [x] 認証システム実装
* [x] データベースモデル設計・実装
* [x] Alembicマイグレーション導入

### Phase 2: バックエンドAPI実装（✅完了）
* [x] タグ管理API実装
* [x] いいね・マッチングAPI実装
* [x] ユーザー検索・フィルターAPI実装
* [x] チャットAPI実装
* [x] 通報・ブロックAPI実装

### Phase 3: フロントエンド実装（✅完了）
* [x] プロジェクトセットアップ
* [x] デザインシステム構築
* [x] 認証・プロフィール画面実装
* [x] ユーザー検索画面実装
* [x] マッチング画面実装
* [x] チャット画面実装

### Phase 4: 統合・テスト（✅完了）
* [x] フロントエンド・バックエンド統合
* [x] 総合テスト（バックエンド22テスト + フロントエンド28テスト）
* [x] セキュリティテスト（実装済み）
* [x] パフォーマンステスト（ガイドライン作成済み）

### Phase 5: デプロイ・運用（🔄準備中）
* [ ] 本番環境構築
* [ ] デプロイ自動化
* [ ] 監視・ログ設定（Sentry統合済み）
* [ ] ユーザーフィードバック収集

### Phase 6: 拡張機能（✅一部完了）
* [ ] n8n連携（AI自動タグ生成）
* [x] リアルタイム通信（WebSocket実装済み）
* [ ] 通知機能
* [ ] 統計・分析機能

---

## 📂 プロジェクト構成

```
qupid-app/
├── app/                    # バックエンド（FastAPI）
│   ├── core/              # コア機能（設定、認証、セキュリティ）
│   ├── db/                # データベース関連
│   ├── models/            # SQLAlchemyモデル
│   ├── routers/           # APIエンドポイント
│   ├── schemas/           # Pydanticスキーマ
│   └── main.py            # アプリケーションエントリーポイント
├── docs/                  # ドキュメント
│   ├── implementation-plans/  # 実装計画書
│   └── requirements.md    # 要件定義書
├── frontend/              # フロントエンド（予定）
├── alembic/               # データベースマイグレーション
├── compose.yml            # Docker Compose設定
├── Dockerfile             # Dockerイメージ設定
└── requirements.txt       # Python依存関係
```

---

## 🎯 成功指標

### 技術指標
* [ ] 全APIエンドポイントが正常に動作
* [ ] テストカバレッジ80%以上
* [ ] レスポンス時間500ms以下
* [ ] セキュリティ要件を満たす

### ビジネス指標
* [ ] 九州大学学生の利用開始
* [ ] マッチング成立数の増加
* [ ] ユーザーフィードバックの収集
* [ ] セーフティ機能の適切な動作

---

## 🔄 次のステップ

1. **バックエンドAPI実装完了** - 残りのAPIエンドポイント実装
2. **フロントエンド開発開始** - Figmaデザインを活用したUI実装
3. **統合テスト** - フロントエンド・バックエンド統合
4. **本番デプロイ** - 九州大学学生向けサービス開始

---

## 📚 関連ドキュメント

* [タグ管理API実装計画書](./implementation-plans/01-tag-management.md)
* [いいね・マッチングAPI実装計画書](./implementation-plans/02-like-matching.md)
* [ユーザー検索・フィルターAPI実装計画書](./implementation-plans/03-user-search.md)
* [チャットAPI実装計画書](./implementation-plans/04-chat-api.md)
* [通報・ブロックAPI実装計画書](./implementation-plans/05-report-block.md)

---

**作成日**: 2025年10月13日
**更新日**: 2025年10月15日
**担当者**: Qupid開発チーム

